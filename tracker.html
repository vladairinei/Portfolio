<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Work Tracker – Vlad Airinei</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="page-wrapper">
    <nav>
      <div class="nav-wrapper">
        <ul class="nav-links">
          <li><a href="index.html">🏠 Home</a></li>
          <li><a href="todoapp.html">📝 ToDoApp</a></li>
          <li><a href="tracker.html">⏱ Work Tracker</a></li>
          <li><a href="contact.html">📫 Contact</a></li>
        </ul>
        <button id="themeToggle">🌓</button>
      </div>
    </nav>

    <main>
      <!-- LOGIN (visible by default) -->
      <section id="loginCard" style="max-width:520px; margin:1rem auto;">
        <h2>Sign in</h2>
        <p>Get a magic link to your email.</p>
        <div class="input-row">
          <input id="loginEmail" type="email" placeholder="you@example.com" />
          <button id="loginBtn" type="button">Send link</button>
        </div>
      </section>

      <!-- APP (hidden until authenticated) -->
      <section id="tracker" style="display:none">
        <h1>🚚 Work Time Tracker</h1>

        <form id="workForm">
          <label for="workDate">Date:</label>
          <div class="date-row">
            <input type="date" id="workDate" required />
            <button type="button" id="openCalendarBtn" aria-label="Open calendar">📅</button>
            <button type="button" id="todayBtn">Today</button>
            <button type="button" id="yesterdayBtn">Yesterday</button>
            <button type="button" id="minusDayBtn">−1d</button>
            <button type="button" id="plusDayBtn">+1d</button>
          </div>

          <label for="dayType">Day type:</label>
          <select id="dayType">
            <option value="normal">Normal</option>
            <option value="vacation">Vacation</option>
            <option value="sick">Sick Leave</option>
          </select>

          <div id="timeInputs">
            <label for="startTime">Start Time:</label>
            <input type="time" id="startTime" />

            <label for="pauseTime">Pause (minutes):</label>
            <input type="number" id="pauseTime" min="0" value="0" />

            <label for="endTime">End Time:</label>
            <input type="time" id="endTime" />
          </div>

          <button type="submit">Calculate</button>
        </form>

        <div id="resultBox">
          <h2>📊 Results</h2>
          <p><strong>Total Worked Time:</strong> <span id="workedTime">-</span></p>
          <p><strong>Night Shift Time:</strong> <span id="nightTime">-</span></p>
          <p><strong>Info:</strong> <span id="infoMessage">-</span></p>
        </div>

        <!-- Calendar (moved INSIDE #tracker) -->
        <section id="calendarSection">
          <h2>📅 Calendar</h2>

          <div class="cal-toolbar">
            <button id="prevMonthBtn" type="button" aria-label="Previous month">←</button>

            <label for="monthOnly" class="sr-only">Month</label>
            <select id="monthOnly">
              <option value="01">Jan</option><option value="02">Feb</option>
              <option value="03">Mar</option><option value="04">Apr</option>
              <option value="05">May</option><option value="06">Jun</option>
              <option value="07">Jul</option><option value="08">Aug</option>
              <option value="09">Sep</option><option value="10">Oct</option>
              <option value="11">Nov</option><option value="12">Dec</option>
            </select>

            <input type="hidden" id="yearPicker" />
            <button id="yearDropdownBtn" type="button" aria-haspopup="true" aria-expanded="false">
              <span id="yearLabel"></span> ▾
            </button>
            <div id="yearDropdown" class="year-dropdown" hidden>
              <div class="year-dropdown-header">
                <button id="prevDecadeBtn" type="button">«</button>
                <span id="yearRangeLabel"></span>
                <button id="nextDecadeBtn" type="button">»</button>
              </div>
              <div id="yearGrid" class="year-grid" role="listbox" aria-label="Choose year"></div>
            </div>

            <button id="nextMonthBtn" type="button" aria-label="Next month">→</button>
          </div>

          <div class="cal-weekdays">
            <div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div><div>Sun</div>
          </div>

          <div id="calendarGrid" class="cal-grid" aria-label="Month calendar"></div>
        </section>

        <!-- Bottom drawer -->
        <div id="dayDrawer" class="drawer" aria-hidden="true">
          <div class="drawer-sheet" role="dialog" aria-modal="true" aria-labelledby="drawerDate">
            <button id="drawerClose" class="drawer-close" aria-label="Close">✕</button>
            <h3 id="drawerDate">—</h3>
            <div id="drawerBody" class="drawer-body"></div>
            <div class="drawer-actions">
              <button id="drawerEdit" class="btn-primary">Add / Edit</button>
              <button id="drawerDelete" class="btn-danger">Delete</button>
            </div>
          </div>
        </div>

        <!-- Summary (moved INSIDE #tracker) -->
        <section id="summarySection">
          <h2>📊 Monthly & Yearly Summary</h2>
          <div class="summary-controls">
            <label for="vacAllowance">Vacation allowance (per year):</label>
            <input type="number" id="vacAllowance" min="0" value="30" />
            <button id="saveAllowanceBtn" type="button">Save</button>
          </div>

          <div class="summary-grid">
            <div class="card">
              <h3>This month</h3>
              <p><strong>Total worked:</strong> <span id="sumWorked">-</span></p>
              <p><strong>Night bonus:</strong> <span id="sumNight">-</span></p>
              <p><strong>Days: </strong>
                Normal <span id="sumDaysNormal">0</span> •
                Vacation <span id="sumDaysVacation">0</span> •
                Sick <span id="sumDaysSick">0</span>
              </p>
            </div>

            <div class="card">
              <h3>This year</h3>
              <p><strong>Vacation used:</strong> <span id="sumVacUsed">0</span></p>
              <p><strong>Vacation remaining:</strong> <span id="sumVacRemaining">0</span></p>
            </div>
          </div>
        </section>
      </section>
    </main>

    <footer>
      <p>© 2025 Vlad Airinei</p>
    </footer>
  </div>

  <!-- Supabase config & client MUST load before your app -->
  <script src="supabase-config.js"></script>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    // @ts-ignore
    window.supabase = createClient(window.__SUPABASE.url, window.__SUPABASE.anonKey);
  </script>

  <script src="theme.js"></script>
  <script type="module" src="dist/tracker.js"></script>
</body>
</html>
